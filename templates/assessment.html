<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Proctoring - Live Assessment</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --primary:#2563eb; --primary-600:#1e40af; --accent:#3b82f6;
      --success:#0f9d58; --warning:#f59e0b; --danger:#d93025;
      --bg:#f7f9fc; --surface:#ffffff; --ink-900:#0f172a; --ink-700:#334155; --ink-500:#64748b;
      --radius-lg:16px; --radius-md:12px; --radius-sm:10px;
      --shadow-sm:0 6px 16px rgba(15,23,42,.10); --shadow-md:0 12px 28px rgba(15,23,42,.16);
      --ring:0 0 0 .2rem rgba(37,99,235,.25)
    }
    *{box-sizing:border-box} html,body{margin:0;padding:0}
    body{font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans";background:var(--bg);color:var(--ink-900);min-height:100vh}
    a{text-decoration:none;color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    .navbar{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border-bottom:1px solid rgba(15,23,42,.06)}
    .nav-wrap{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .nav{display:flex;gap:18px}
    .nav a{padding:10px 12px;border-radius:10px;color:var(--ink-700)}
    .nav a.active,.nav a:hover{background:rgba(37,99,235,.08);color:var(--primary)}
    .page{padding:20px 0}
    .info{background:linear-gradient(135deg,#e0e7ff,#c7d2fe);border:1px solid rgba(37,99,235,.15);color:#0b1a3a;border-radius:var(--radius-md);padding:16px;margin-bottom:16px;box-shadow:var(--shadow-sm)}
    .row{display:grid;grid-template-columns:2fr 1fr;gap:20px}
    .panel{background:var(--surface);border:1px solid rgba(2,6,23,.06);border-radius:15px;padding:20px;box-shadow:var(--shadow-sm)}
    .video-wrap{position:relative;background:#000;border-radius:15px;overflow:hidden;box-shadow:var(--shadow-md)}
    #video{width:100%;height:auto;min-height:320px;object-fit:cover;display:block}
    .overlay{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.6);color:#fff;padding:8px 12px;border-radius:20px;font-weight:600}
    .controls{margin-top:12px}
    .muted{color:var(--ink-500)}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:11px 22px;border-radius:999px;border:1px solid transparent;cursor:pointer;transition:.2s transform,.2s box-shadow}
    .btn-start{background:var(--success);color:#fff;box-shadow:0 8px 20px rgba(15,157,88,.22)}
    .btn-start:hover{transform:translateY(-1px);background:#0c8b4c}
    .meter{background:#e5e7eb;border-radius:10px;height:16px;overflow:hidden}
    .fill{height:100%;border-radius:10px;transition:width .4s ease,background-color .4s ease;background:var(--success)}
    .kv{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(2,6,23,.06)}
    .kv:last-child{border-bottom:none}
    .chip{display:inline-block;padding:6px 12px;border-radius:999px;font-weight:700;font-size:.85rem}
    .ok{background:#e8faf1;color:#147d55}
    .warn{background:#fff4e5;color:#a86207}
    .bad{background:#fde8e8;color:#b42318}
    .status{position:fixed;top:16px;right:16px;background:rgba(0,0,0,.75);color:#fff;padding:10px 16px;border-radius:999px;font-weight:700;box-shadow:0 4px 16px rgba(0,0,0,.25)}
    .tips{margin-top:16px;padding:12px;border-left:4px solid var(--primary);border-radius:10px;background:#f0f5ff;color:#0b1a3a}
    footer{margin-top:24px;text-align:center;color:var(--ink-700);padding:16px 0}
    @media (max-width:980px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="navbar">
    <div class="container nav-wrap">
      <a class="brand" href="/"><i class="fas fa-shield-alt"></i><span>AI Proctor</span></a>
      <nav class="nav">
        <a href="/">Home</a>
        <a class="active" href="/assessment">Assessment</a>
      </nav>
    </div>
  </header>

  <div class="status" id="connection-status"><i class="fas fa-circle me-2"></i>Connecting...</div>

  <main class="page">
    <div class="container">
      <div class="info">
        <strong><i class="fas fa-info-circle"></i> Assessment Instructions:</strong>
        Ensure a clear face view, steady lighting, and avoid looking away; detection includes persons, devices, head pose, and audio activity.
      </div>

      <div class="row">
        <section>
          <div class="video-wrap">
            <video id="video" autoplay muted playsinline>
              <p>Your browser does not support the video element.</p>
            </video>
            <div class="overlay"><i class="fas fa-video"></i> Live Camera Feed</div>
          </div>

          <div class="panel controls">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
              <div>
                <h3 style="margin:0 0 4px">Proctoring Controls</h3>
                <p class="muted" style="margin:0">Start monitoring to begin YOLO detection, head pose, and audio checks</p>
              </div>
              <button id="startBtn" class="btn btn-start" onclick="toggleStreaming()">
                <i class="fas fa-play"></i> Start AI Detection
              </button>
            </div>
          </div>
        </section>

        <aside>
          <div class="panel">
            <h3 style="margin-top:0;margin-bottom:14px"><i class="fas fa-chart-line"></i> Detection Status</h3>

            <div id="stats">
              <div class="kv"><span class="muted">Suspicion Level</span><span id="suspicionValue" class="chip ok">0%</span></div>
              <div class="meter"><div class="fill" id="suspicionMeter" style="width:0%"></div></div>

              <div class="kv"><span class="muted">Detection</span><span id="aiGuessValue" class="chip ok">Ready</span></div>
              <div class="kv"><span class="muted">Head Position</span><span id="headPoseValue" class="chip ok">✅ OK</span></div>
              <div class="kv"><span class="muted">Audio Monitor</span><span id="audioValue" class="chip ok">✅ OK</span></div>
              <div class="kv"><span class="muted">Deepfake Check</span><span id="deepfakeValue" class="chip ok">✅ OK</span></div>

              <div class="kv"><span class="muted">People</span><span id="peopleSummary" class="chip" style="background:#eef2ff;color:#1e2a66">None</span></div>
              <div class="kv"><span class="muted">Devices</span><span id="devicesSummary" class="chip" style="background:#eef2ff;color:#1e2a66">None</span></div>
              <div class="kv"><span class="muted">Audio RMS</span><span id="audioRmsValue" class="chip" style="background:#eef2ff;color:#1e2a66">0.0000</span></div>
            </div>

            <div class="tips">
              <strong><i class="fas fa-lightbulb"></i> Tips</strong>
              <ul style="margin:8px 0 0 18px;color:var(--ink-700)">
                <li>Keep the face centered in the camera</li>
                <li>Ensure good lighting on the face</li>
                <li>Avoid multiple people or devices in frame</li>
                <li>Minimize background audio and noise</li>
              </ul>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <footer>© 2025 AI Proctoring System</footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
